<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <title>ğŸ“š Quáº£n lÃ½ Sinh viÃªn</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        table { width: 100%; border-collapse: collapse; margin-top: 20px; }
        th, td { border: 1px solid #ddd; padding: 10px; text-align: center; }
        th { background-color: #f2f2f2; }
        input, button { padding: 8px; margin: 5px; }
        #student-form { margin-bottom: 20px; }
        .btn { cursor: pointer; border: none; border-radius: 5px; padding: 8px 12px; }
        .btn-add { background-color: #4CAF50; color: white; }
        .btn-delete { background-color: #f44336; color: white; }
        .btn-update { background-color: #2196F3; color: white; }
        .btn-export { background-color: #FF9800; color: white; }
        .btn-import { background-color: #9C27B0; color: white; }
    </style>
</head>
<body>

<h2>ğŸ“š Quáº£n lÃ½ Sinh viÃªn</h2>

<div id="student-form">
    <input type="text" id="studentId" placeholder="ID (náº¿u cáº­p nháº­t)">
    <input type="text" id="name" placeholder="TÃªn sinh viÃªn">
    <input type="email" id="email" placeholder="Email">
    <input type="text" id="phone" placeholder="Sá»‘ Ä‘iá»‡n thoáº¡i">
    <input type="date" id="dob" placeholder="NgÃ y sinh">
    <input type="text" id="address" placeholder="Äá»‹a chá»‰">
    <button class="btn btn-add" onclick="addOrUpdateStudent()">ğŸ’¾ LÆ°u</button>
</div>

<button class="btn btn-export" onclick="exportExcel()">ğŸ“¤ Xuáº¥t Excel</button>
<input type="file" id="excelFile">
<button class="btn btn-import" onclick="importExcel()">ğŸ“¥ Import Excel</button>

<table id="studentsTable">
    <thead>
    <tr>
        <th>ID</th>
        <th>ğŸ‘¤ TÃªn</th>
        <th>ğŸ“§ Email</th>
        <th>ğŸ“ Sá»‘ Ä‘iá»‡n thoáº¡i</th>
        <th>ğŸ‚ NgÃ y sinh</th>
        <th>ğŸ  Äá»‹a chá»‰</th>
        <th>ğŸ› ï¸ Thao tÃ¡c</th>
    </tr>
    </thead>
    <tbody></tbody>
</table>

<script>
    const apiBaseUrl = "/students";

    // ğŸ“œ Láº¥y danh sÃ¡ch sinh viÃªn
    async function loadStudents() {
        const response = await fetch(apiBaseUrl);
        const students = await response.json();
        const tbody = document.querySelector("#studentsTable tbody");
        tbody.innerHTML = "";

        students.forEach(student => {
            const row = `<tr>
                    <td>${student.id}</td>
                    <td>${student.name}</td>
                    <td>${student.email}</td>
                    <td>${student.phone}</td>
                    <td>${student.dateOfBirth}</td>
                    <td>${student.address}</td>
                    <td>
                        <button class="btn btn-update" onclick="editStudent(${student.id}, '${student.name}', '${student.email}', '${student.phone}', '${student.dateOfBirth}', '${student.address}')">âœï¸ Sá»­a</button>
                        <button class="btn btn-delete" onclick="deleteStudent(${student.id})">ğŸ—‘ï¸ XÃ³a</button>
                    </td>
                </tr>`;
            tbody.innerHTML += row;
        });
    }

    // â• ThÃªm hoáº·c ğŸ“ Cáº­p nháº­t sinh viÃªn
    async function addOrUpdateStudent() {
        const id = document.getElementById("studentId").value;
        const name = document.getElementById("name").value;
        const email = document.getElementById("email").value;
        const phone = document.getElementById("phone").value;
        const dateOfBirth = document.getElementById("dob").value;
        const address = document.getElementById("address").value;

        const method = id ? "PUT" : "POST";
        const url = id ? `${apiBaseUrl}/${id}` : apiBaseUrl;

        const response = await fetch(url, {
            method: method,
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({ name, email, phone, dateOfBirth, address })
        });
        if (response.ok) {
            alert(id ? "ğŸ“ Cáº­p nháº­t thÃ nh cÃ´ng!" : "âœ… ThÃªm sinh viÃªn thÃ nh cÃ´ng!");
            loadStudents();
            document.getElementById("student-form").reset();
        } else {
            alert("âŒ Thao tÃ¡c tháº¥t báº¡i!");
        }
    }

    // ğŸ“ Chá»‰nh sá»­a sinh viÃªn
    function editStudent(id, name, email, phone, dateOfBirth, address) {
        document.getElementById("studentId").value = id;
        document.getElementById("name").value = name;
        document.getElementById("email").value = email;
        document.getElementById("phone").value = phone;
        document.getElementById("dob").value = dateOfBirth;
        document.getElementById("address").value = address;
    }

    // âŒ XÃ³a sinh viÃªn
    async function deleteStudent(id) {
        if (confirm("ğŸ—‘ï¸ Báº¡n cÃ³ cháº¯c cháº¯n muá»‘n xÃ³a sinh viÃªn nÃ y khÃ´ng?")) {
            const response = await fetch(`${apiBaseUrl}/${id}`, { method: "DELETE" });
            if (response.ok) {
                alert("ğŸ—‘ï¸ XÃ³a thÃ nh cÃ´ng!");
                loadStudents();
            } else {
                alert("âŒ XÃ³a tháº¥t báº¡i!");
            }
        }
    }

    // ğŸ“¤ Xuáº¥t file Excel
    function exportExcel() {
        window.location.href = `${apiBaseUrl}/export/excel`;
    }

    // ğŸ“¥ Import file Excel
    async function importExcel() {
        const fileInput = document.getElementById("excelFile");
        const file = fileInput.files[0];

        if (!file) {
            alert("âŒ Vui lÃ²ng chá»n file Excel!");
            return;
        }

        const formData = new FormData();
        formData.append("file", file);

        try {
            const response = await fetch("http://localhost:8080/students/import", {
                method: "POST",
                body: formData, // âœ… KhÃ´ng cáº§n headers, trÃ¬nh duyá»‡t sáº½ tá»± Ä‘áº·t Content-Type
            });

            const message = await response.text();
            alert(message);
        } catch (error) {
            console.error("Lá»—i khi import:", error);
            alert("âŒ Import tháº¥t báº¡i!");
        }
    }


    // ğŸ“œ Load danh sÃ¡ch sinh viÃªn khi trang Ä‘Æ°á»£c táº£i
    window.onload = loadStudents;
</script>
</body>
</html>
