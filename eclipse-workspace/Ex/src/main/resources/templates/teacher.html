<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8">
  <title>ğŸ‘¨â€ğŸ« Quáº£n lÃ½ GiÃ¡o viÃªn</title>
  <style>
    body { font-family: Arial, sans-serif; margin: 20px; }
    table { width: 100%; border-collapse: collapse; margin-top: 20px; }
    th, td { border: 1px solid #ddd; padding: 10px; text-align: center; }
    th { background-color: #f2f2f2; }
    input, button { padding: 8px; margin: 5px; }
    #teacher-form { margin-bottom: 20px; }
    .btn { cursor: pointer; border: none; border-radius: 5px; padding: 8px 12px; }
    .btn-add { background-color: #4CAF50; color: white; }
    .btn-delete { background-color: #f44336; color: white; }
    .btn-update { background-color: #2196F3; color: white; }
    .btn-export { background-color: #FF9800; color: white; }
    .btn-import { background-color: #9C27B0; color: white; }
  </style>
</head>
<body>

<h2>ğŸ‘¨â€ğŸ« Quáº£n lÃ½ GiÃ¡o viÃªn</h2>

<div id="teacher-form">
  <input type="text" id="teacherId" placeholder="ID (náº¿u cáº­p nháº­t)">
  <input type="text" id="name" placeholder="TÃªn giÃ¡o viÃªn">
  <input type="text" id="email" placeholder="Email">
  <button class="btn btn-add" onclick="addOrUpdateTeacher()">ğŸ’¾ LÆ°u</button>
</div>

<button class="btn btn-export" onclick="exportExcel()">ğŸ“¤ Xuáº¥t Excel</button>
<input type="file" id="excelFile">
<button class="btn btn-import" onclick="importExcel()">ğŸ“¥ Import Excel</button>

<table id="teachersTable">
  <thead>
  <tr>
    <th>ID</th>
    <th>ğŸ‘¤ TÃªn</th>
    <th>ğŸ“§ Email</th>
    <th>ğŸ“š KhoÃ¡ há»c phá»¥ trÃ¡ch</th>
    <th>ğŸ› ï¸ Thao tÃ¡c</th>
  </tr>
  </thead>
  <tbody></tbody>
</table>

<script>
  const apiBaseUrl = "/teachers";

  // ğŸ“œ Láº¥y danh sÃ¡ch giÃ¡o viÃªn
  async function loadTeachers() {
    const response = await fetch(apiBaseUrl);
    const teachers = await response.json();
    const tbody = document.querySelector("#teachersTable tbody");
    tbody.innerHTML = "";

    for (const teacher of teachers) {
      const coursesResponse = await fetch(`${apiBaseUrl}/${teacher.id}/courses`);
      const courses = await coursesResponse.json();
      const courseNames = courses.map(course => course.name).join(", ") || "ChÆ°a cÃ³";

      const row = `<tr>
                    <td>${teacher.id}</td>
                    <td>${teacher.name}</td>
                    <td>${teacher.email}</td>
                    <td>${courseNames}</td>
                    <td>
                        <button class="btn btn-update" onclick="editTeacher(${teacher.id}, '${teacher.name}', '${teacher.email}')">âœï¸ Sá»­a</button>
                        <button class="btn btn-delete" onclick="deleteTeacher(${teacher.id})">ğŸ—‘ï¸ XÃ³a</button>
                    </td>
                </tr>`;
      tbody.innerHTML += row;
    }
  }

  // â• ThÃªm hoáº·c ğŸ“ Cáº­p nháº­t giÃ¡o viÃªn
  async function addOrUpdateTeacher() {
    const id = document.getElementById("teacherId").value;
    const name = document.getElementById("name").value;
    const email = document.getElementById("email").value;

    const method = id ? "PUT" : "POST";
    const url = id ? `${apiBaseUrl}/${id}` : apiBaseUrl;

    const response = await fetch(url, {
      method: method,
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({ name, email })
    });

    if (response.ok) {
      alert(id ? "ğŸ“ Cáº­p nháº­t giÃ¡o viÃªn thÃ nh cÃ´ng!" : "âœ… ThÃªm giÃ¡o viÃªn thÃ nh cÃ´ng!");
      loadTeachers();
      document.getElementById("teacherId").value = "";
      document.getElementById("name").value = "";
      document.getElementById("email").value = "";
    } else {
      alert("âŒ Thao tÃ¡c tháº¥t báº¡i!");
    }
  }

  // ğŸ“ Chá»‰nh sá»­a thÃ´ng tin giÃ¡o viÃªn
  function editTeacher(id, name, email) {
    document.getElementById("teacherId").value = id;
    document.getElementById("name").value = name;
    document.getElementById("email").value = email;
  }

  // âŒ XÃ³a giÃ¡o viÃªn
  async function deleteTeacher(id) {
    if (confirm("ğŸ—‘ï¸ Báº¡n cÃ³ cháº¯c cháº¯n muá»‘n xÃ³a giÃ¡o viÃªn nÃ y khÃ´ng?")) {
      const response = await fetch(`${apiBaseUrl}/${id}`, { method: "DELETE" });
      if (response.ok) {
        alert("ğŸ—‘ï¸ XÃ³a thÃ nh cÃ´ng!");
        loadTeachers();
      } else {
        alert("âŒ XÃ³a tháº¥t báº¡i!");
      }
    }
  }

  // ğŸ“¤ Xuáº¥t file Excel
  function exportExcel() {
    window.location.href = `${apiBaseUrl}/export/excel`;
  }

  // ğŸ“¥ Import file Excel
  async function importExcel() {
    const fileInput = document.getElementById("excelFile");
    const file = fileInput.files[0];
    if (!file) return alert("âŒ Vui lÃ²ng chá»n file Excel!");

    const formData = new FormData();
    formData.append("file", file);

    const response = await fetch(`${apiBaseUrl}/import?filePath=C://Users//Hiep Phuong//Desktop//${file.name}`, {
      method: "POST"
    });

    if (response.ok) {
      alert("âœ… Import file Excel thÃ nh cÃ´ng!");
      loadTeachers();
    } else {
      alert("âŒ Import tháº¥t báº¡i!");
    }
  }

  // ğŸ“œ Load danh sÃ¡ch giÃ¡o viÃªn khi trang Ä‘Æ°á»£c táº£i
  window.onload = loadTeachers;
</script>
</body>
</html>
